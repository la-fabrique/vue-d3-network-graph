(function(W,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("vue"),require("@vueuse/core")):typeof define=="function"&&define.amd?define(["exports","vue","@vueuse/core"],g):(W=typeof globalThis<"u"?globalThis:W||self,g(W["vue-d3-network-graph"]={},W.Vue,W.VueUseCore))})(this,function(W,g,P){"use strict";const En="";function Pt(t,n){const e=g.ref(void 0),r=g.reactive({x:0,y:0}),o=d=>{let u,l=0;return d instanceof MouseEvent?(u=d.clientX,l=d.clientY):d instanceof TouchEvent&&(u=d.touches[0].clientX,l=d.touches[0].clientY),{x:u||0,y:l||0}},i=(d,u)=>n.value?(()=>{e.value=u,c(d,t.value.nodes()[u])})():void 0,c=(d,u)=>{let l=0,x=0;if(d&&u&&(u!=null&&u.x)&&(u!=null&&u.y)){const v=o(d);l=v.x?v.x-u.x:u.x,x=v.y?v.y-u.y:u.y}r.x=l,r.y=x},a=()=>{e.value!==void 0&&y()},y=()=>{e.value=void 0,t.value.alpha(.1),t.value.restart(),c()};return{dragStart:i,dragEnd:a,dragMove:d=>{const u=o(d);e.value!=null&&t.value.nodes()[e.value]&&(t.value.restart(),t.value.alpha(.5),t.value.nodes()[e.value].fx=u.x-r.x,t.value.nodes()[e.value].fy=u.y-r.y)}}}const ct="arrow-start",ft="arrow-end";function It(t,n,e){const r=c=>e.value&&c.twoWay?`url(#${ct})`:void 0,o=c=>e.value?`url(#${ft})`:void 0,i=g.computed(()=>({arrowStart:{id:ct,refX:0,refY:0,viewBox:"0 -5 10 10",orient:"auto",markerWidth:10,markerHeight:10},arrowEnd:{id:ft,refX:10,refY:0,viewBox:"0 -5 10 10",orient:"auto",markerWidth:10,markerHeight:10}}));return{getMarkerEnd:o,getMarkerStart:r,markers:i}}function Bt(t){const n=+this._x.call(null,t),e=+this._y.call(null,t);return ht(this.cover(n,e),n,e,t)}function ht(t,n,e,r){if(isNaN(n)||isNaN(e))return t;var o,i=t._root,c={data:r},a=t._x0,y=t._y0,s=t._x1,d=t._y1,u,l,x,v,f,h,p,_;if(!i)return t._root=c,t;for(;i.length;)if((f=n>=(u=(a+s)/2))?a=u:s=u,(h=e>=(l=(y+d)/2))?y=l:d=l,o=i,!(i=i[p=h<<1|f]))return o[p]=c,t;if(x=+t._x.call(null,i.data),v=+t._y.call(null,i.data),n===x&&e===v)return c.next=i,o?o[p]=c:t._root=c,t;do o=o?o[p]=new Array(4):t._root=new Array(4),(f=n>=(u=(a+s)/2))?a=u:s=u,(h=e>=(l=(y+d)/2))?y=l:d=l;while((p=h<<1|f)===(_=(v>=l)<<1|x>=u));return o[_]=i,o[p]=c,t}function Wt(t){var n,e,r=t.length,o,i,c=new Array(r),a=new Array(r),y=1/0,s=1/0,d=-1/0,u=-1/0;for(e=0;e<r;++e)isNaN(o=+this._x.call(null,n=t[e]))||isNaN(i=+this._y.call(null,n))||(c[e]=o,a[e]=i,o<y&&(y=o),o>d&&(d=o),i<s&&(s=i),i>u&&(u=i));if(y>d||s>u)return this;for(this.cover(y,s).cover(d,u),e=0;e<r;++e)ht(this,c[e],a[e],t[e]);return this}function Yt(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,r=this._y0,o=this._x1,i=this._y1;if(isNaN(e))o=(e=Math.floor(t))+1,i=(r=Math.floor(n))+1;else{for(var c=o-e||1,a=this._root,y,s;e>t||t>=o||r>n||n>=i;)switch(s=(n<r)<<1|t<e,y=new Array(4),y[s]=a,a=y,c*=2,s){case 0:o=e+c,i=r+c;break;case 1:e=o-c,i=r+c;break;case 2:o=e+c,r=i-c;break;case 3:e=o-c,r=i-c;break}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=r,this._x1=o,this._y1=i,this}function Xt(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function Vt(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function b(t,n,e,r,o){this.node=t,this.x0=n,this.y0=e,this.x1=r,this.y1=o}function jt(t,n,e){var r,o=this._x0,i=this._y0,c,a,y,s,d=this._x1,u=this._y1,l=[],x=this._root,v,f;for(x&&l.push(new b(x,o,i,d,u)),e==null?e=1/0:(o=t-e,i=n-e,d=t+e,u=n+e,e*=e);v=l.pop();)if(!(!(x=v.node)||(c=v.x0)>d||(a=v.y0)>u||(y=v.x1)<o||(s=v.y1)<i))if(x.length){var h=(c+y)/2,p=(a+s)/2;l.push(new b(x[3],h,p,y,s),new b(x[2],c,p,h,s),new b(x[1],h,a,y,p),new b(x[0],c,a,h,p)),(f=(n>=p)<<1|t>=h)&&(v=l[l.length-1],l[l.length-1]=l[l.length-1-f],l[l.length-1-f]=v)}else{var _=t-+this._x.call(null,x.data),M=n-+this._y.call(null,x.data),w=_*_+M*M;if(w<e){var E=Math.sqrt(e=w);o=t-E,i=n-E,d=t+E,u=n+E,r=x.data}}return r}function Ht(t){if(isNaN(d=+this._x.call(null,t))||isNaN(u=+this._y.call(null,t)))return this;var n,e=this._root,r,o,i,c=this._x0,a=this._y0,y=this._x1,s=this._y1,d,u,l,x,v,f,h,p;if(!e)return this;if(e.length)for(;;){if((v=d>=(l=(c+y)/2))?c=l:y=l,(f=u>=(x=(a+s)/2))?a=x:s=x,n=e,!(e=e[h=f<<1|v]))return this;if(!e.length)break;(n[h+1&3]||n[h+2&3]||n[h+3&3])&&(r=n,p=h)}for(;e.data!==t;)if(o=e,!(e=e.next))return this;return(i=e.next)&&delete e.next,o?(i?o.next=i:delete o.next,this):n?(i?n[h]=i:delete n[h],(e=n[0]||n[1]||n[2]||n[3])&&e===(n[3]||n[2]||n[1]||n[0])&&!e.length&&(r?r[p]=e:this._root=e),this):(this._root=i,this)}function Gt(t){for(var n=0,e=t.length;n<e;++n)this.remove(t[n]);return this}function Ot(){return this._root}function Ut(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function Kt(t){var n=[],e,r=this._root,o,i,c,a,y;for(r&&n.push(new b(r,this._x0,this._y0,this._x1,this._y1));e=n.pop();)if(!t(r=e.node,i=e.x0,c=e.y0,a=e.x1,y=e.y1)&&r.length){var s=(i+a)/2,d=(c+y)/2;(o=r[3])&&n.push(new b(o,s,d,a,y)),(o=r[2])&&n.push(new b(o,i,d,s,y)),(o=r[1])&&n.push(new b(o,s,c,a,d)),(o=r[0])&&n.push(new b(o,i,c,s,d))}return this}function Qt(t){var n=[],e=[],r;for(this._root&&n.push(new b(this._root,this._x0,this._y0,this._x1,this._y1));r=n.pop();){var o=r.node;if(o.length){var i,c=r.x0,a=r.y0,y=r.x1,s=r.y1,d=(c+y)/2,u=(a+s)/2;(i=o[0])&&n.push(new b(i,c,a,d,u)),(i=o[1])&&n.push(new b(i,d,a,y,u)),(i=o[2])&&n.push(new b(i,c,u,d,s)),(i=o[3])&&n.push(new b(i,d,u,y,s))}e.push(r)}for(;r=e.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function qt(t){return t[0]}function Zt(t){return arguments.length?(this._x=t,this):this._x}function Jt(t){return t[1]}function te(t){return arguments.length?(this._y=t,this):this._y}function ot(t,n,e){var r=new it(n??qt,e??Jt,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function it(t,n,e,r,o,i){this._x=t,this._y=n,this._x0=e,this._y0=r,this._x1=o,this._y1=i,this._root=void 0}function gt(t){for(var n={data:t.data},e=n;t=t.next;)e=e.next={data:t.data};return n}var C=ot.prototype=it.prototype;C.copy=function(){var t=new it(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,e,r;if(!n)return t;if(!n.length)return t._root=gt(n),t;for(e=[{source:n,target:t._root=new Array(4)}];n=e.pop();)for(var o=0;o<4;++o)(r=n.source[o])&&(r.length?e.push({source:r,target:n.target[o]=new Array(4)}):n.target[o]=gt(r));return t},C.add=Bt,C.addAll=Wt,C.cover=Yt,C.data=Xt,C.extent=Vt,C.find=jt,C.remove=Ht,C.removeAll=Gt,C.root=Ot,C.size=Ut,C.visit=Kt,C.visitAfter=Qt,C.x=Zt,C.y=te;function z(t){return function(){return t}}function Y(t){return(t()-.5)*1e-6}function ee(t){return t.x+t.vx}function ne(t){return t.y+t.vy}function re(t){var n,e,r,o=1,i=1;typeof t!="function"&&(t=z(t==null?1:+t));function c(){for(var s,d=n.length,u,l,x,v,f,h,p=0;p<i;++p)for(u=ot(n,ee,ne).visitAfter(a),s=0;s<d;++s)l=n[s],f=e[l.index],h=f*f,x=l.x+l.vx,v=l.y+l.vy,u.visit(_);function _(M,w,E,T,R){var S=M.data,$=M.r,k=f+$;if(S){if(S.index>l.index){var D=x-S.x-S.vx,I=v-S.y-S.vy,F=D*D+I*I;F<k*k&&(D===0&&(D=Y(r),F+=D*D),I===0&&(I=Y(r),F+=I*I),F=(k-(F=Math.sqrt(F)))/F*o,l.vx+=(D*=F)*(k=($*=$)/(h+$)),l.vy+=(I*=F)*k,S.vx-=D*(k=1-k),S.vy-=I*k)}return}return w>x+k||T<x-k||E>v+k||R<v-k}}function a(s){if(s.data)return s.r=e[s.data.index];for(var d=s.r=0;d<4;++d)s[d]&&s[d].r>s.r&&(s.r=s[d].r)}function y(){if(n){var s,d=n.length,u;for(e=new Array(d),s=0;s<d;++s)u=n[s],e[u.index]=+t(u,s,n)}}return c.initialize=function(s,d){n=s,r=d,y()},c.iterations=function(s){return arguments.length?(i=+s,c):i},c.strength=function(s){return arguments.length?(o=+s,c):o},c.radius=function(s){return arguments.length?(t=typeof s=="function"?s:z(+s),y(),c):t},c}function oe(t){return t.index}function yt(t,n){var e=t.get(n);if(!e)throw new Error("node not found: "+n);return e}function ie(t){var n=oe,e=u,r,o=z(30),i,c,a,y,s,d=1;t==null&&(t=[]);function u(h){return 1/Math.min(a[h.source.index],a[h.target.index])}function l(h){for(var p=0,_=t.length;p<d;++p)for(var M=0,w,E,T,R,S,$,k;M<_;++M)w=t[M],E=w.source,T=w.target,R=T.x+T.vx-E.x-E.vx||Y(s),S=T.y+T.vy-E.y-E.vy||Y(s),$=Math.sqrt(R*R+S*S),$=($-i[M])/$*h*r[M],R*=$,S*=$,T.vx-=R*(k=y[M]),T.vy-=S*k,E.vx+=R*(k=1-k),E.vy+=S*k}function x(){if(c){var h,p=c.length,_=t.length,M=new Map(c.map((E,T)=>[n(E,T,c),E])),w;for(h=0,a=new Array(p);h<_;++h)w=t[h],w.index=h,typeof w.source!="object"&&(w.source=yt(M,w.source)),typeof w.target!="object"&&(w.target=yt(M,w.target)),a[w.source.index]=(a[w.source.index]||0)+1,a[w.target.index]=(a[w.target.index]||0)+1;for(h=0,y=new Array(_);h<_;++h)w=t[h],y[h]=a[w.source.index]/(a[w.source.index]+a[w.target.index]);r=new Array(_),v(),i=new Array(_),f()}}function v(){if(c)for(var h=0,p=t.length;h<p;++h)r[h]=+e(t[h],h,t)}function f(){if(c)for(var h=0,p=t.length;h<p;++h)i[h]=+o(t[h],h,t)}return l.initialize=function(h,p){c=h,s=p,x()},l.links=function(h){return arguments.length?(t=h,x(),l):t},l.id=function(h){return arguments.length?(n=h,l):n},l.iterations=function(h){return arguments.length?(d=+h,l):d},l.strength=function(h){return arguments.length?(e=typeof h=="function"?h:z(+h),v(),l):e},l.distance=function(h){return arguments.length?(o=typeof h=="function"?h:z(+h),f(),l):o},l}var se={value:()=>{}};function dt(){for(var t=0,n=arguments.length,e={},r;t<n;++t){if(!(r=arguments[t]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new q(e)}function q(t){this._=t}function ae(t,n){return t.trim().split(/^|\s+/).map(function(e){var r="",o=e.indexOf(".");if(o>=0&&(r=e.slice(o+1),e=e.slice(0,o)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}q.prototype=dt.prototype={constructor:q,on:function(t,n){var e=this._,r=ae(t+"",e),o,i=-1,c=r.length;if(arguments.length<2){for(;++i<c;)if((o=(t=r[i]).type)&&(o=le(e[o],t.name)))return o;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++i<c;)if(o=(t=r[i]).type)e[o]=xt(e[o],t.name,n);else if(n==null)for(o in e)e[o]=xt(e[o],t.name,null);return this},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new q(t)},call:function(t,n){if((o=arguments.length-2)>0)for(var e=new Array(o),r=0,o,i;r<o;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(n,e)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,i=r.length;o<i;++o)r[o].value.apply(n,e)}};function le(t,n){for(var e=0,r=t.length,o;e<r;++e)if((o=t[e]).name===n)return o.value}function xt(t,n,e){for(var r=0,o=t.length;r<o;++r)if(t[r].name===n){t[r]=se,t=t.slice(0,r).concat(t.slice(r+1));break}return e!=null&&t.push({name:n,value:e}),t}var V=0,H=0,G=0,pt=1e3,Z,O,J=0,X=0,tt=0,U=typeof performance=="object"&&performance.now?performance:Date,vt=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function _t(){return X||(vt(ue),X=U.now()+tt)}function ue(){X=0}function st(){this._call=this._time=this._next=null}st.prototype=wt.prototype={constructor:st,restart:function(t,n,e){if(typeof t!="function")throw new TypeError("callback is not a function");e=(e==null?_t():+e)+(n==null?0:+n),!this._next&&O!==this&&(O?O._next=this:Z=this,O=this),this._call=t,this._time=e,at()},stop:function(){this._call&&(this._call=null,this._time=1/0,at())}};function wt(t,n,e){var r=new st;return r.restart(t,n,e),r}function ce(){_t(),++V;for(var t=Z,n;t;)(n=X-t._time)>=0&&t._call.call(void 0,n),t=t._next;--V}function mt(){X=(J=U.now())+tt,V=H=0;try{ce()}finally{V=0,he(),X=0}}function fe(){var t=U.now(),n=t-J;n>pt&&(tt-=n,J=t)}function he(){for(var t,n=Z,e,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Z=e);O=t,at(r)}function at(t){if(!V){H&&(H=clearTimeout(H));var n=t-X;n>24?(t<1/0&&(H=setTimeout(mt,t-U.now()-tt)),G&&(G=clearInterval(G))):(G||(J=U.now(),G=setInterval(fe,pt)),V=1,vt(mt))}}const ge=1664525,ye=1013904223,Mt=4294967296;function de(){let t=1;return()=>(t=(ge*t+ye)%Mt)/Mt}function xe(t){return t.x}function pe(t){return t.y}var ve=10,_e=Math.PI*(3-Math.sqrt(5));function Nt(t){var n,e=1,r=.001,o=1-Math.pow(r,1/300),i=0,c=.6,a=new Map,y=wt(u),s=dt("tick","end"),d=de();t==null&&(t=[]);function u(){l(),s.call("tick",n),e<r&&(y.stop(),s.call("end",n))}function l(f){var h,p=t.length,_;f===void 0&&(f=1);for(var M=0;M<f;++M)for(e+=(i-e)*o,a.forEach(function(w){w(e)}),h=0;h<p;++h)_=t[h],_.fx==null?_.x+=_.vx*=c:(_.x=_.fx,_.vx=0),_.fy==null?_.y+=_.vy*=c:(_.y=_.fy,_.vy=0);return n}function x(){for(var f=0,h=t.length,p;f<h;++f){if(p=t[f],p.index=f,p.fx!=null&&(p.x=p.fx),p.fy!=null&&(p.y=p.fy),isNaN(p.x)||isNaN(p.y)){var _=ve*Math.sqrt(.5+f),M=f*_e;p.x=_*Math.cos(M),p.y=_*Math.sin(M)}(isNaN(p.vx)||isNaN(p.vy))&&(p.vx=p.vy=0)}}function v(f){return f.initialize&&f.initialize(t,d),f}return x(),n={tick:l,restart:function(){return y.restart(u),n},stop:function(){return y.stop(),n},nodes:function(f){return arguments.length?(t=f,x(),a.forEach(v),n):t},alpha:function(f){return arguments.length?(e=+f,n):e},alphaMin:function(f){return arguments.length?(r=+f,n):r},alphaDecay:function(f){return arguments.length?(o=+f,n):+o},alphaTarget:function(f){return arguments.length?(i=+f,n):i},velocityDecay:function(f){return arguments.length?(c=1-f,n):1-c},randomSource:function(f){return arguments.length?(d=f,a.forEach(v),n):d},force:function(f,h){return arguments.length>1?(h==null?a.delete(f):a.set(f,v(h)),n):a.get(f)},find:function(f,h,p){var _=0,M=t.length,w,E,T,R,S;for(p==null?p=1/0:p*=p,_=0;_<M;++_)R=t[_],w=f-R.x,E=h-R.y,T=w*w+E*E,T<p&&(S=R,p=T);return S},on:function(f,h){return arguments.length>1?(s.on(f,h),n):s.on(f)}}}function we(){var t,n,e,r,o=z(-30),i,c=1,a=1/0,y=.81;function s(x){var v,f=t.length,h=ot(t,xe,pe).visitAfter(u);for(r=x,v=0;v<f;++v)n=t[v],h.visit(l)}function d(){if(t){var x,v=t.length,f;for(i=new Array(v),x=0;x<v;++x)f=t[x],i[f.index]=+o(f,x,t)}}function u(x){var v=0,f,h,p=0,_,M,w;if(x.length){for(_=M=w=0;w<4;++w)(f=x[w])&&(h=Math.abs(f.value))&&(v+=f.value,p+=h,_+=h*f.x,M+=h*f.y);x.x=_/p,x.y=M/p}else{f=x,f.x=f.data.x,f.y=f.data.y;do v+=i[f.data.index];while(f=f.next)}x.value=v}function l(x,v,f,h){if(!x.value)return!0;var p=x.x-n.x,_=x.y-n.y,M=h-v,w=p*p+_*_;if(M*M/y<w)return w<a&&(p===0&&(p=Y(e),w+=p*p),_===0&&(_=Y(e),w+=_*_),w<c&&(w=Math.sqrt(c*w)),n.vx+=p*x.value*r/w,n.vy+=_*x.value*r/w),!0;if(x.length||w>=a)return;(x.data!==n||x.next)&&(p===0&&(p=Y(e),w+=p*p),_===0&&(_=Y(e),w+=_*_),w<c&&(w=Math.sqrt(c*w)));do x.data!==n&&(M=i[x.data.index]*r/w,n.vx+=p*M,n.vy+=_*M);while(x=x.next)}return s.initialize=function(x,v){t=x,e=v,d()},s.strength=function(x){return arguments.length?(o=typeof x=="function"?x:z(+x),d(),s):o},s.distanceMin=function(x){return arguments.length?(c=x*x,s):Math.sqrt(c)},s.distanceMax=function(x){return arguments.length?(a=x*x,s):Math.sqrt(a)},s.theta=function(x){return arguments.length?(y=x*x,s):Math.sqrt(y)},s}function me(t){var n=z(.1),e,r,o;typeof t!="function"&&(t=z(t==null?0:+t));function i(a){for(var y=0,s=e.length,d;y<s;++y)d=e[y],d.vx+=(o[y]-d.x)*r[y]*a}function c(){if(e){var a,y=e.length;for(r=new Array(y),o=new Array(y),a=0;a<y;++a)r[a]=isNaN(o[a]=+t(e[a],a,e))?0:+n(e[a],a,e)}}return i.initialize=function(a){e=a,c()},i.strength=function(a){return arguments.length?(n=typeof a=="function"?a:z(+a),c(),i):n},i.x=function(a){return arguments.length?(t=typeof a=="function"?a:z(+a),c(),i):t},i}function Me(t){var n=z(.1),e,r,o;typeof t!="function"&&(t=z(t==null?0:+t));function i(a){for(var y=0,s=e.length,d;y<s;++y)d=e[y],d.vy+=(o[y]-d.y)*r[y]*a}function c(){if(e){var a,y=e.length;for(r=new Array(y),o=new Array(y),a=0;a<y;++a)r[a]=isNaN(o[a]=+t(e[a],a,e))?0:+n(e[a],a,e)}}return i.initialize=function(a){e=a,c()},i.strength=function(a){return arguments.length?(n=typeof a=="function"?a:z(+a),c(),i):n},i.y=function(a){return arguments.length?(t=typeof a=="function"?a:z(+a),c(),i):t},i}const j=t=>!!t&&typeof t!="number"&&typeof t!="string",Ne=(t,n)=>n===void 0?t:typeof n=="number"?n:n.width>n.height?n.width:n.height,Et=(t,n)=>Ne(t,n)/2,Ee=(t,n)=>n===void 0?t:typeof n=="number"?n:n.width,ke=(t,n)=>n===void 0?t:typeof n=="number"?n:n.height,kt=(t,n,e,r,o)=>{const i=Math.sqrt((r-t)*(r-t)+(o-n)*(o-n));return{x:t+e*(r-t)/i,y:n+e*(o-n)/i}},lt=(t,n)=>t?[t,...n||[]]:n||[],Se=1664525,Ae=1013904223,St=4294967296;function At(){let t=1;return()=>(t=(Se*t+Ae)%St)/St}function Te(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Re(t,n){let e=t.length,r,o;for(;e;)o=n()*e--|0,r=t[e],t[e]=t[o],t[o]=r;return t}function $e(t){return Tt(t,At())}function Tt(t,n){for(var e=0,r=(t=Re(Array.from(t),n)).length,o=[],i,c;e<r;)i=t[e],c&&Rt(c,i)?++e:(c=Le(o=De(o,i)),e=0);return c}function De(t,n){var e,r;if(ut(n,t))return[n];for(e=0;e<t.length;++e)if(et(n,t[e])&&ut(K(t[e],n),t))return[t[e],n];for(e=0;e<t.length-1;++e)for(r=e+1;r<t.length;++r)if(et(K(t[e],t[r]),n)&&et(K(t[e],n),t[r])&&et(K(t[r],n),t[e])&&ut($t(t[e],t[r],n),t))return[t[e],t[r],n];throw new Error}function et(t,n){var e=t.r-n.r,r=n.x-t.x,o=n.y-t.y;return e<0||e*e<r*r+o*o}function Rt(t,n){var e=t.r-n.r+Math.max(t.r,n.r,1)*1e-9,r=n.x-t.x,o=n.y-t.y;return e>0&&e*e>r*r+o*o}function ut(t,n){for(var e=0;e<n.length;++e)if(!Rt(t,n[e]))return!1;return!0}function Le(t){switch(t.length){case 1:return be(t[0]);case 2:return K(t[0],t[1]);case 3:return $t(t[0],t[1],t[2])}}function be(t){return{x:t.x,y:t.y,r:t.r}}function K(t,n){var e=t.x,r=t.y,o=t.r,i=n.x,c=n.y,a=n.r,y=i-e,s=c-r,d=a-o,u=Math.sqrt(y*y+s*s);return{x:(e+i+y/u*d)/2,y:(r+c+s/u*d)/2,r:(u+o+a)/2}}function $t(t,n,e){var r=t.x,o=t.y,i=t.r,c=n.x,a=n.y,y=n.r,s=e.x,d=e.y,u=e.r,l=r-c,x=r-s,v=o-a,f=o-d,h=y-i,p=u-i,_=r*r+o*o-i*i,M=_-c*c-a*a+y*y,w=_-s*s-d*d+u*u,E=x*v-l*f,T=(v*w-f*M)/(E*2)-r,R=(f*h-v*p)/E,S=(x*M-l*w)/(E*2)-o,$=(l*p-x*h)/E,k=R*R+$*$-1,D=2*(i+T*R+S*$),I=T*T+S*S-i*i,F=-(Math.abs(k)>1e-6?(D+Math.sqrt(D*D-4*k*I))/(2*k):I/D);return{x:r+T+R*F,y:o+S+$*F,r:F}}function Dt(t,n,e){var r=t.x-n.x,o,i,c=t.y-n.y,a,y,s=r*r+c*c;s?(i=n.r+e.r,i*=i,y=t.r+e.r,y*=y,i>y?(o=(s+y-i)/(2*s),a=Math.sqrt(Math.max(0,y/s-o*o)),e.x=t.x-o*r-a*c,e.y=t.y-o*c+a*r):(o=(s+i-y)/(2*s),a=Math.sqrt(Math.max(0,i/s-o*o)),e.x=n.x+o*r-a*c,e.y=n.y+o*c+a*r)):(e.x=n.x+e.r,e.y=n.y)}function Lt(t,n){var e=t.r+n.r-1e-6,r=n.x-t.x,o=n.y-t.y;return e>0&&e*e>r*r+o*o}function bt(t){var n=t._,e=t.next._,r=n.r+e.r,o=(n.x*e.r+e.x*n.r)/r,i=(n.y*e.r+e.y*n.r)/r;return o*o+i*i}function nt(t){this._=t,this.next=null,this.previous=null}function Ce(t,n){if(!(i=(t=Te(t)).length))return 0;var e,r,o,i,c,a,y,s,d,u,l;if(e=t[0],e.x=0,e.y=0,!(i>1))return e.r;if(r=t[1],e.x=-r.r,r.x=e.r,r.y=0,!(i>2))return e.r+r.r;Dt(r,e,o=t[2]),e=new nt(e),r=new nt(r),o=new nt(o),e.next=o.previous=r,r.next=e.previous=o,o.next=r.previous=e;t:for(y=3;y<i;++y){Dt(e._,r._,o=t[y]),o=new nt(o),s=r.next,d=e.previous,u=r._.r,l=e._.r;do if(u<=l){if(Lt(s._,o._)){r=s,e.next=r,r.previous=e,--y;continue t}u+=s._.r,s=s.next}else{if(Lt(d._,o._)){e=d,e.next=r,r.previous=e,--y;continue t}l+=d._.r,d=d.previous}while(s!==d.next);for(o.previous=e,o.next=r,e.next=r.previous=r=o,c=bt(e);(o=o.next)!==r;)(a=bt(o))<c&&(e=o,c=a);r=e.next}for(e=[r._],o=r;(o=o.next)!==r;)e.push(o._);for(o=Tt(e,n),y=0;y<i;++y)e=t[y],e.x-=o.x,e.y-=o.y;return o.r}function ze(t){return Ce(t,At()),t}function Fe(t){const n=s=>s||t.value,e=s=>Ee(t.value,s.size),r=s=>ke(t.value,s.size),o=(s,d)=>(s||0)-(d||0)/2,i=(s,d)=>(s||0)-(d||0)/2,c=(s,d)=>`<circle cx="${s.x}" cy="${s.y}" r="${s.r+1}" class="node-group" />`+d.map(u=>{var l;return`<circle cx="${u.x}" cy="${u.y}" r="${u.r}" class="${u.class}" >
              <title>${(l=u.labels)==null?void 0:l.join(",")}</title>
          </circle>`}).join(""),a=(s,d,u,l)=>{const x=ze(d.map(f=>({...y(f),r:Et(t.value,f.size)}))),v=$e(x);return{id:s.id,key:s.id,x:u,y:l,innerSVG:{viewBox:`-${v.r+2} -${v.r+2} ${v.r*2+4} ${v.r*2+4}`,innerHtml:c(v,x)},width:v.r*2,height:v.r*2,labels:lt(s.name,s.labels),title:s.name,class:["node-group"],r:v.r}},y=(s,d,u,l)=>{var x,v;return d&&d.length>0?a(s,d,u,l):{id:s.id,key:s.id,x:u,y:l,fx:(x=s.position)==null?void 0:x.x,fy:(v=s.position)==null?void 0:v.y,innerSVG:s.innerSVG,width:e(s),height:r(s),labels:lt(s.name,s.labels),title:s.name,class:s.class?["node",...s.class||[]]:["node"],r:Et(t.value,s.size)}};return{getNode:y,getSize:n,getX:o,getY:i}}const Pe="arrow-start",Ie="arrow-end";function Be(t,n){const e=i=>n.value&&i.twoWay?`url(#${Pe})`:void 0,r=i=>n.value?`url(#${Ie})`:void 0;return{getMarkerEnd:r,getMarkerStart:e,getLink:i=>({source:i.source,target:i.target,labels:lt(i.name,i.labels),class:i.class?["link",i.class]:["link"],"stroke-width":t.value,"marker-end":r(),"marker-start":e(i)})}}const We=(t,n,e)=>{const{getNode:r}=Fe(t),{getLink:o}=Be(n,e),i=(a,y,s)=>a.source===y&&a.target===s||a.source===s&&a.target===y;return{reduce:(a,y)=>{const s=a.reduce((u,l)=>{if(l.group===void 0)return u.push(l),u;const x=u.find(v=>v.id===`g-${l.group}`);return x&&x.children?(x.children.push(l),u):(u.push({id:`g-${l.group}`,children:[l]}),u)},[]).map(u=>r(u,u.children)),d=y.reduce((u,l)=>{const x=s.find(p=>p.id===l.source),v=s.find(p=>p.id===l.target);if(x&&v)return u.push(l),u;const f=a.find(p=>p.id===l.source),h=a.find(p=>p.id===l.target);if(P.isDefined(f==null?void 0:f.group)&&P.isDefined(h==null?void 0:h.group)){if((f==null?void 0:f.group)===(h==null?void 0:h.group))return u;const p=u.find(_=>i(_,`g-${f.group}`,`g-${h.group}`));return p?!p.twoWay&&p.source!==`g-${f.group}`&&(p.twoWay=!0):u.push({...l,source:`g-${f.group}`,target:`g-${h.group}`,name:l.name||`g-${f.group}-${h.group}`}),u}return P.isDefined(f==null?void 0:f.group)&&h&&!P.isDefined(h==null?void 0:h.group)?(u.push({...l,source:`g-${f.group}`,name:l.name||`g-${f.group}-${h.id}`}),u):(f&&!P.isDefined(f==null?void 0:f.group)&&P.isDefined(h==null?void 0:h.group)&&u.push({...l,target:`g-${h.group}`,name:l.name||`${f.id}-${h.group}`}),u)},[]).map(u=>o(u));return{nodes:s,links:d}}}},Ye="X",Xe="Y",Ve="charge",je="link",He="collide",Ct=.01,zt=.1,Ge=Math.log(Ct)/Math.log(1-zt);function Oe(t,n,e,r){const{reduce:o}=We(r.nodeSize,r.linkWidth,r.directed),i=g.shallowRef([]),c=g.ref([]),a=g.computed(()=>i.value.map(l=>{if(j(l.target)&&j(l.source)){const x=kt(l.target.x,l.target.y,l.target.r,l.source.x,l.source.y),v=kt(l.source.x,l.source.y,l.source.r,l.target.x,l.target.y);l.xS=v.x,l.yS=v.y,l.xT=x.x,l.yT=x.y}return l})),y=()=>{const l=o(t.value,n.value);c.value=l.nodes,i.value=l.links,s()},s=async()=>{u.value.stop(),u.value=d(),r.static.value?u.value.tick(Ge):u.value.restart()},d=()=>{const l=Nt().alphaMin(Ct).alphaDecay(zt).nodes(c.value);return l.force(Ye,me(e.value.width/2).strength(r.forceXStrength.value)),l.force(Xe,Me(e.value.height/2).strength(r.forceYStrength.value)),l.force(Ve,we().strength(r.forcManyBodyStrength.value)),l.force(He,re(r.forceCollideStrength.value)),l.force(je,ie(i.value).id(x=>{if(!("id"in x))throw new Error("Node id is undefined");return x.id})),l},u=g.ref(Nt());return P.watchDebounced([()=>t.value.length,()=>n.value.length,e,r.nodeSize,r.linkWidth,r.forcManyBodyStrength,r.forceXStrength,r.forceYStrength,r.forceCollideStrength,r.directed],async()=>y(),{debounce:100,maxWait:1e3}),P.watchDebounced(r.static,async()=>s(),{deep:!0,debounce:100,maxWait:1e3}),{simulation:u,nodes:c,links:a}}const Ue=.1,Ke=.1,Qe=-300,qe=25,Ze=12,Je=1,tn=45,en=t=>({options:{static:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.layout)==null?void 0:r.static)||!1}),forceXStrength:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.simulation)==null?void 0:r.force.x)||Ue}),forceYStrength:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.simulation)==null?void 0:r.force.y)||Ke}),forcManyBodyStrength:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.simulation)==null?void 0:r.force.charge)||Qe}),forceCollideStrength:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.simulation)==null?void 0:r.force.collide)||tn}),nodeSize:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.nodes)==null?void 0:r.size)||qe}),nodeFontSize:g.toRef(()=>{var e,r,o;return((o=(r=(e=t.value)==null?void 0:e.nodes)==null?void 0:r.font)==null?void 0:o.size)||Ze}),linkWidth:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.links)==null?void 0:r.width)||Je}),linkFontSize:g.toRef(()=>{var e,r,o;return((o=(r=(e=t.value)==null?void 0:e.links)==null?void 0:r.font)==null?void 0:o.size)||12}),draggable:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.layout)==null?void 0:r.draggable)||!1}),directed:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.layout)==null?void 0:r.directed)||!1}),themeClass:g.toRef(()=>{var e,r,o,i;return(r=(e=t.value)==null?void 0:e.layout)!=null&&r.theme?`theme-${(i=(o=t.value)==null?void 0:o.layout)==null?void 0:i.theme}`:"theme-teal"}),dark:g.toRef(()=>{var e,r;return((r=(e=t.value)==null?void 0:e.layout)==null?void 0:r.dark)||!1})}}),nn=(t,n)=>({label:g.computed(()=>({font:{size:t.value},offset:{x:n.value/2+t.value/2,y:t.value/2}}))}),rn=t=>({label:g.computed(()=>({font:{size:t.value}})),getX:o=>j(o.source)&&j(o.target)&&o.source.x&&o.target.x?o.target.x>o.source.x?o.source.x+(o.target.x-o.source.x)/2:o.target.x+(o.source.x-o.target.x)/2:void 0,getY:o=>j(o.source)&&j(o.target)&&o.source.y&&o.target.y?o.target.y>o.source.y?o.source.y+(o.target.y-o.source.y)/2:o.target.y+(o.source.y-o.target.y)/2:void 0}),on=t=>{const n=g.ref({Sx:1,Qx:0,Qy:0,Sy:1,Tx:0,Ty:0}),e=g.computed(()=>`matrix(${n.value.Sx},${n.value.Qx},${n.value.Qy},${n.value.Sy},${n.value.Tx},${n.value.Ty})`),r={x:0,y:0},o=u=>u>=.5&&u<=4,i=()=>r.x!==0&&r.y!==0,c=(u,l,x,v)=>({x:u-v,y:l-x});return{transform:e,zoom:(u,l,x)=>{const v=n.value.Sx+x;if(!o(v))return;const f=c(u,l,t.value.top,t.value.left);n.value.Tx=v/n.value.Sx*(n.value.Tx-f.x)+f.x,n.value.Ty=v/n.value.Sx*(n.value.Ty-f.y)+f.y,n.value.Sx=v,n.value.Sy=v},panMove:(u,l)=>{if(!i())return;const x=u-r.x,v=l-r.y;n.value.Tx+=x,n.value.Ty+=v,r.x=u,r.y=l},panStart:(u,l)=>{r.x=u,r.y=l},panEnd:()=>{r.x=0,r.y=0}}},sn=["viewBox","onMousedown","onWheel"],an={key:0},ln=[g.createElementVNode("path",{class:"link",d:"M 0 5 L 0 -5 L 10 0 L 0 5"},null,-1)],un=[g.createElementVNode("path",{class:"link",d:"M 10 5 L 0 0 L 10 -5 L 10 5"},null,-1)],cn=["transform"],fn={class:"links"},hn=["id","d","stroke-width","marker-end","marker-start","onClick","onTouchstartPassive"],gn=["font-size","y"],yn=["dy","x"],dn={class:"nodes"},xn=["viewBox","width","height","x","y","title","onClick","onTouchendPassive","onMousedown","onTouchstartPassive","innerHTML"],pn=["cx","cy","r","title","onClick","onTouchendPassive","onMousedown","onTouchstartPassive"],vn=["y","font-size"],_n=["dy","x"],Ft=g.defineComponent({__name:"D3NetworkGraph",props:{nodes:{type:Array,required:!0},links:{type:Array,required:!0},options:{type:Object,default:void 0}},emits:["node-click","link-click"],setup(t,{emit:n}){const e=t,{options:r}=en(g.toRef(()=>e.options)),o=g.ref(null),i=g.ref(null),c=g.ref({width:100,height:100,top:0,left:0}),{transform:a,zoom:y,panMove:s,panStart:d,panEnd:u}=on(c),l=g.computed(()=>["svg-container",`${r.themeClass.value}${r.dark.value?"--dark":""}`]),x=N=>{N.width===c.value.width&&N.height===c.value.height||(c.value={top:N.top,left:N.left,width:N.width,height:N.height})};P.useResizeObserver(o,N=>{const m=N[0].target.getBoundingClientRect();x(m)});const v=N=>P.isDefined(N.xS)&&P.isDefined(N.yS)&&P.isDefined(N.xT)&&P.isDefined(N.yT)?`M${N.xS} ${N.yS} L${N.xT} ${N.yT}`:void 0,{simulation:f,nodes:h,links:p}=Oe(g.toRef(()=>e.nodes),g.toRef(()=>e.links),c,r),{dragStart:_,dragEnd:M,dragMove:w}=Pt(f,r.draggable),{label:E}=nn(r.nodeFontSize,r.nodeSize),{label:T,getX:R,getY:S}=rn(r.linkFontSize),{markers:$}=It(r.linkWidth,r.nodeSize,r.directed),k=(N,B,m)=>{n("node-click",N,e.nodes[m])},D=(N,B,m)=>{n("link-click",N,e.links[m])},I=async N=>{if(!N.ctrlKey||!i.value)return;const B=N.deltaY||N.deltaX,m=Math.abs(B)<50?.05:.25,L=B<0?m:-m;y(N.clientX,N.clientY,L)},F=N=>{w(N),s(N.clientX,N.clientY)},mn=N=>{d(N.clientX,N.clientY)},rt=(N,B)=>_(N,B),Mn=()=>{M(),u()},Nn=()=>M();return g.onMounted(()=>{if(o.value){const N=o.value.getBoundingClientRect();x(N)}}),(N,B)=>(g.openBlock(),g.createElementBlock("svg",{ref_key:"svg",ref:o,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",preserveAspectRatio:"xMinYMin",viewBox:`0 0 ${c.value.width} ${c.value.height}`,class:g.normalizeClass(l.value),onMousedown:g.withModifiers(mn,["self","prevent"]),onMouseup:Mn,onTouchendPassive:Nn,onTouchstartPassive:B[0]||(B[0]=async()=>{}),onMousemove:F,onWheel:g.withModifiers(I,["prevent"])},[g.unref(r).directed?(g.openBlock(),g.createElementBlock("defs",an,[g.createElementVNode("marker",g.normalizeProps(g.guardReactiveProps(g.unref($).arrowEnd)),ln,16),g.createElementVNode("marker",g.normalizeProps(g.guardReactiveProps(g.unref($).arrowStart)),un,16)])):g.createCommentVNode("",!0),g.createElementVNode("g",{ref_key:"canvas",ref:i,class:"svg-canvas",transform:g.unref(a)},[g.createElementVNode("g",fn,[(g.openBlock(!0),g.createElementBlock(g.Fragment,null,g.renderList(g.unref(p),(m,L)=>(g.openBlock(),g.createElementBlock(g.Fragment,{key:L},[g.createElementVNode("path",{id:`${L}`,d:v(m),"stroke-width":m["stroke-width"],class:g.normalizeClass(m.class),style:g.normalizeStyle(m.style),"marker-end":m["marker-end"],"marker-start":m["marker-start"],onClick:A=>D(A,m,L),onTouchstartPassive:A=>D(A,m,L)},null,46,hn),g.createElementVNode("text",{class:"link-label","font-size":g.unref(T).font.size,y:g.unref(S)(m)},[(g.openBlock(!0),g.createElementBlock(g.Fragment,null,g.renderList(m.labels,(A,Q)=>(g.openBlock(),g.createElementBlock("tspan",{key:Q,dy:Q>0?"1.1em":"0",x:g.unref(R)(m)},g.toDisplayString(A),9,yn))),128))],8,gn)],64))),128))]),g.createElementVNode("g",dn,[(g.openBlock(!0),g.createElementBlock(g.Fragment,null,g.renderList(g.unref(h),(m,L)=>(g.openBlock(),g.createElementBlock(g.Fragment,{key:L},[m.innerSVG?(g.openBlock(),g.createElementBlock("svg",{key:0,viewBox:m.innerSVG.viewBox,width:m.width,height:m.height,x:(m.x||0)-(m.width||0)/2,y:(m.y||0)-(m.height||0)/2,title:m.name,class:g.normalizeClass(m.class),onClick:A=>k(A,m,L),onTouchendPassive:A=>k(A,m,L),onMousedown:g.withModifiers(A=>rt(A,L),["prevent"]),onTouchstartPassive:g.withModifiers(A=>rt(A,L),["prevent"]),innerHTML:m.innerSVG.innerHtml},null,42,xn)):(g.openBlock(),g.createElementBlock("circle",{key:1,cx:m.x,cy:m.y,r:m.r,title:m.name,class:g.normalizeClass(m.class),onClick:A=>k(A,m,L),onTouchendPassive:A=>k(A,m,L),onMousedown:g.withModifiers(A=>rt(A,L),["prevent"]),onTouchstartPassive:g.withModifiers(A=>rt(A,L),["prevent"])},null,42,pn)),g.createElementVNode("text",{class:"node-label",y:(m.y||0)+g.unref(E).offset.y,"font-size":g.unref(E).font.size},[(g.openBlock(!0),g.createElementBlock(g.Fragment,null,g.renderList(m.labels,(A,Q)=>(g.openBlock(),g.createElementBlock("tspan",{key:Q,dy:Q>0?"1.1em":"0",x:(m.x||0)+(m.width||0)},g.toDisplayString(A),9,_n))),128))],8,vn)],64))),128))])],8,cn)],42,sn))}}),An="",wn={install(t){t.component("D3NetworkGraph",Ft)}};W.D3NetworkGraph=Ft,W.default=wn,Object.defineProperties(W,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
